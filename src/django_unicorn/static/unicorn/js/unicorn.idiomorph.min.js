/* Version: dev */
var Unicorn=function(e){"use strict";function t(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=Array(t);i<t;i++)n[i]=e[i];return n}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t,i){return t&&function(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,o(n.key),n)}}(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function r(e){return function(e){if(Array.isArray(e))return t(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,i){if(e){if("string"==typeof e)return t(e,i);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?t(e,i):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var n=i.call(e,t);if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e,"string");return"symbol"==typeof t?t:t+""}function a(e,t,i){var n,r=this;return function(){for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];var s=r;clearTimeout(n),n=setTimeout(function(){n=null,e.apply(s,o)},t)}}function s(e){return null==e||0===Object.keys(e).length&&e.constructor===Object||""===e}function l(e){return!s(e)}function u(e){return e&&"function"==typeof e}function c(e,t){return!!e&&e.indexOf(t)>-1}function d(e,t){return void 0===t&&(t=document),t.querySelector(e)}var h={acceptNode:function(e){return NodeFilter.FILTER_ACCEPT}},f={acceptNode:function(e){return e.getAttribute("unicorn:checksum")?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT}};function m(e,t){for(var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:h,n=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,i,!1);n.nextNode();)t(n.currentNode)}var p=function(){return n(function e(t){i(this,e),this.attribute=t,this.name=this.attribute.name,this.value=this.attribute.value,this.isUnicorn=!1,this.isModel=!1,this.isPoll=!1,this.isLoading=!1,this.isTarget=!1,this.isPartial=!1,this.isDirty=!1,this.isVisible=!1,this.isKey=!1,this.isError=!1,this.modifiers={},this.eventType=null,this.init()},[{key:"init",value:function(){var e=this;if(this.name.startsWith("unicorn:")||this.name.startsWith("u:")){if(this.isUnicorn=!0,c(this.name,":model")||c(this.name,":bind"))this.isModel=!0;else if(c(this.name,":poll.disable"))this.isPollDisable=!0;else if(c(this.name,":poll"))this.isPoll=!0;else if(c(this.name,":loading"))this.isLoading=!0;else if(c(this.name,":target"))this.isTarget=!0;else if(c(this.name,":partial"))this.isPartial=!0;else if(c(this.name,":dirty"))this.isDirty=!0;else if(c(this.name,":visible"))this.isVisible=!0;else if("unicorn:key"===this.name||"u:key"===this.name)this.isKey=!0;else if(c(this.name,":error:"))this.isError=!0;else{var t=this.name.replace("unicorn:","").replace("u:","");"id"!==t&&"name"!==t&&"checksum"!==t&&(this.eventType=t)}var i=this.name;this.eventType&&(i=this.eventType),i.split(".").slice(1).forEach(function(t){var i=t.split("-");e.modifiers[i[0]]=!(i.length>1)||i[1],e.eventType&&(e.eventType=e.eventType.replace(".".concat(t),""))})}}}])}(),v=function(){function e(t){i(this,e),this.el=t,this.init()}return n(e,[{key:"init",value:function(){var t=this;if(this.id=this.el.id,this.isUnicorn=!1,this.attributes=[],this.value=this.getValue(),this.parent=null,this.el.parentElement&&(this.parent=new e(this.el.parentElement)),this.model={},this.poll={},this.loading={},this.dirty={},this.actions=[],this.partials=[],this.target=null,this.visibility={},this.key=null,this.events=[],this.errors=[],this.el.attributes)for(var i=function(){var e=new p(t.el.attributes[n]);if(t.attributes.push(e),e.isUnicorn&&(t.isUnicorn=!0),e.isModel){var i="model";t[i].name=e.value,t[i].eventType=e.modifiers.lazy?"blur":"input",t[i].isLazy=!!e.modifiers.lazy,t[i].isDefer=!!e.modifiers.defer,t[i].debounceTime=e.modifiers.debounce&&parseInt(e.modifiers.debounce,10)||-1}else if(e.isPoll){t.poll.method=e.value?e.value:"refresh",t.poll.timing=2e3,t.poll.disable=!1;var r=e.name.split("-").slice(1);r.length>0&&(t.poll.timing=parseInt(r[0],10)||2e3)}else if(e.isPollDisable)t.poll.disableData=e.value;else if(e.isLoading||e.isDirty){var o="dirty";if(e.isLoading&&(o="loading"),e.modifiers.attr?t[o].attr=e.value:e.modifiers.class&&e.modifiers.remove?t[o].removeClasses=e.value.split(" "):e.modifiers.class?t[o].classes=e.value.split(" "):e.isLoading&&e.modifiers.remove?t.loading.hide=!0:e.isLoading&&(t.loading.show=!0),t.loading&&e.modifiers.delay){var a=parseInt(e.modifiers.delay,10);t.loading.delay=Number.isNaN(a)?200:a}}else if(e.isTarget)t.target=e.value;else if(e.isPartial)e.modifiers.id?t.partials.push({id:e.value}):e.modifiers.key?t.partials.push({key:e.value}):t.partials.push({target:e.value});else if(e.isVisible){var s=e.modifiers.threshold||0;s>1&&(s/=100),t.visibility.method=e.value,t.visibility.threshold=s,t.visibility.debounceTime=e.modifiers.debounce&&parseInt(e.modifiers.debounce,10)||0}else if(e.eventType){var l={};l.name=e.value,l.eventType=e.eventType,l.isPrevent=!1,l.isStop=!1,l.isDiscard=!1,l.isDisable=!1,l.debounceTime=0,e.modifiers&&Object.keys(e.modifiers).forEach(function(t){"prevent"===t?l.isPrevent=!0:"stop"===t?l.isStop=!0:"discard"===t?l.isDiscard=!0:"disable"===t?l.isDisable=!0:"debounce"===t?l.debounceTime=e.modifiers.debounce&&parseInt(e.modifiers.debounce,10)||0:l.key=t}),t.actions.push(l)}if(e.isKey&&(t.key=e.value),e.isError){var u=e.name.replace("unicorn:error:","");t.errors.push({code:u,message:e.value})}},n=0;n<this.el.attributes.length;n++)i()}},{key:"focus",value:function(){this.el.focus()}},{key:"hide",value:function(){this.el.hidden="hidden"}},{key:"show",value:function(){this.el.hidden=null}},{key:"getUnicornParent",value:function(){for(var e=this.parent;e&&!e.isUnicorn;){if(e.isRoot())return null;e=e.parent}return e}},{key:"handleLoading",value:function(e){var t=this;if(this.loading.delay){if(!e)return void(this.loading.timer=setTimeout(function(){t.handleInterfacer("loading",e),t.loading.timer=null},this.loading.delay));if(this.loading.timer)return clearTimeout(this.loading.timer),void(this.loading.timer=null)}this.handleInterfacer("loading",e)}},{key:"handleDirty",value:function(e){this.handleInterfacer("dirty",e)}},{key:"handleInterfacer",value:function(e,t){if(t=t||!1,l(this[e])){var i,n,o,a;if(this[e].attr&&(t?this.el.removeAttribute(this[e].attr):this.el.setAttribute(this[e].attr,this[e].attr)),this[e].classes)if(t)(i=this.el.classList).remove.apply(i,r(this[e].classes)),0===this.el.classList.length&&this.el.removeAttribute("class");else(n=this.el.classList).add.apply(n,r(this[e].classes));if(this[e].removeClasses)if(t)(o=this.el.classList).add.apply(o,r(this[e].removeClasses));else(a=this.el.classList).remove.apply(a,r(this[e].removeClasses))}}},{key:"isSame",value:function(e){return this.isSameEl(e.el)}},{key:"isSameEl",value:function(e){return this.el.isSameNode(e)}},{key:"isSameId",value:function(e){return this.key&&e.key&&this.key===e.key||this.id&&e.id&&this.id===e.id}},{key:"getValue",value:function(){var e=this.el.value;if(this.el.type)if("checkbox"===this.el.type.toLowerCase())e=this.el.checked;else if("select-multiple"===this.el.type.toLowerCase()){e=[];for(var t=0;t<this.el.selectedOptions.length;t++)e.push(this.el.selectedOptions[t].value)}return e}},{key:"setValue",value:function(e){s(this.el.type)||("radio"===this.el.type.toLowerCase()?this.el.value===e&&(this.el.checked=!0):"checkbox"===this.el.type.toLowerCase()?this.el.checked=e:"select-one"===this.el.type.toLowerCase()&&null==e||(this.el.value=e))}},{key:"addError",value:function(e){this.errors.push(e),this.el.setAttribute("unicorn:error:".concat(e.code),e.message)}},{key:"removeErrors",value:function(){var e=this;this.errors.forEach(function(t){e.el.removeAttribute("unicorn:error:".concat(t.code))}),this.errors=[]}},{key:"isRoot",value:function(){return l(this.el.getAttribute("unicorn:checksum"))}}])}();function g(e,t){t.handleLoading(),e.loadingEls.forEach(function(i){if(i.target)if(i.target.includes("*")){var n=(s=i.target,l=s.split("*"),u="",l.forEach(function(e,t){0===t&&""===e?u=u.concat("[a-zA-Z0-9_:.\\-]*"):t===l.length-1?""!==e&&(u=u.concat("(".concat(e,")"))):u=u.concat("(".concat(e,")"),"[a-zA-Z0-9_:.\\-]*")}),new RegExp(u)),o=[];r(e.root.getElementsByTagName("*")).forEach(function(e){r(e.attributes).forEach(function(t){["id","unicorn:key","u:key"].includes(t.name)&&t.value.match(n)&&o.push(e)})}),o.forEach(function(e){t.el.isSameNode(e)&&(i.handleLoading(),i.loading.hide?i.hide():i.loading.show&&i.show())})}else{var a=d("#".concat(i.target),e.root);a||e.keyEls.forEach(function(e){a||e.key!==i.target||(a=e.el)}),a&&t.el.isSameNode(a)&&(i.handleLoading(),i.loading.hide?i.hide():i.loading.show&&i.show())}else i.handleLoading(),i.loading.hide?i.hide():i.loading.show&&i.show();var s,l,u})}function y(e,t,i){return(t=t.trim().slice(t.indexOf(i)+i.length).trim()).split(".").forEach(function(t){if(t=t.trim())if(t.endsWith("()")){var i=t.slice(0,t.length-2);e=e[i]()}else{if(!l(e[t]))throw Error("'".concat(t,"' could not be retrieved"));e=e[t]}}),"string"==typeof e&&(e='"'.concat(e,'"')),e}function b(e,t){e.document.addEventListener(t,function(i){var n=new v(i.target);n&&!n.isUnicorn&&(n=n.getUnicornParent()),n&&n.isUnicorn&&n.actions.length>0&&t in e.actionEvents&&e.actionEvents[t].forEach(function(t){var r=t.action,o=t.element;if(n.isSame(o)){e.walker(o.el,function(t){e.modelEls.filter(function(e){return e.isSameEl(t)}).forEach(function(t){if(l(t.model)&&t.model.isLazy){var i={type:"syncInput",payload:{name:t.model.name,value:t.getValue()}};e.actionQueue.push(i)}})}),r.isPrevent&&i.preventDefault(),r.isStop&&i.stopPropagation(),r.isDiscard&&(e.actionQueue=[]);var a=r.name;(function(e){if(!c(e=e.trim(),"(")||!e.endsWith(")"))return[];e=e.slice(e.indexOf("(")+1,e.length-1);for(var t=[],i="",n=!1,r=!1,o=0,a=0,s=0;s<e.length;s++){var l=e.charAt(s);i+=l,"["===l?a++:"]"===l?a--:"("===l?o++:")"===l?o--:"{"===l||"}"===l||("'"===l?n=!n:'"'===l?r=!r:","===l&&(n||r||0!==a||0!==o||(i=i.slice(0,i.length-1),t.push(i),i=""))),s===e.length-1&&(n||r||0!==a||0!==o||(t.push(i.trim()),i=""))}return t})(a).forEach(function(t){if(t.startsWith("$event"))try{var n=y(i,t,"$event");a=a.replace(t,n)}catch(e){a=a.replace(t,"")}else if(t.startsWith("$returnValue"))if(l(e.return)&&l(e.return.value))try{var r=y(e.return.value,t,"$returnValue");a=a.replace(t,r)}catch(e){a=a.replace(t,"")}else a=a.replace(t,"")}),r.key&&r.key!==function(e){if(!e)return"";var t=e.match(/[A-Z]{2,}(?=[A-Z][a-z]+[0-9]*|\b)|[A-Z]?[a-z]+[0-9]*|[A-Z]|[0-9]+/g);return t?t.map(function(e){return e.toLowerCase()}).join("-"):e}(i.key)||(r.isDisable&&(o.el.disabled=!0,e.actionCleanups.push(function(){o.el.disabled=!1})),g(e,n),e.callMethod(a,r.debounceTime,n.partials))}})})}function E(e,t,i){i=i||t.model.eventType,t.events.push(i),t.el.addEventListener(i,function(n){var r=!1;if(e.data[t.model.name]!==t.getValue()?(r=!0,t.handleDirty()):t.handleDirty(!0),t.model.isLazy){if("input"===i)return;if(!r)return}var o={type:"syncInput",payload:{name:t.model.name,value:t.getValue()},partials:t.partials};if(e.lastTriggeringElements.some(function(e){return e.isSame(t)})||e.lastTriggeringElements.push(t),t.model.isDefer){var a=-1;return e.actionQueue.forEach(function(e,i){e.payload.name===t.model.name&&(e.payload.value=t.getValue(),a=i)}),r&&-1===a&&e.actionQueue.push(o),void(!r&&a>-1&&e.actionQueue.splice(a))}e.actionQueue.push(o),e.queueMessage(t.model.debounceTime,function(i,n,r){r?console.error(r):((i=i||[]).some(function(e){return e.isSame(t)})||i.push(t),e.setModelValues(i,n,!0))})})}var k={},A={};function T(e,t){if(0!==e.actionQueue.length&&e.currentActionQueue!==e.actionQueue){var i=e.actionQueue.some(function(e){return"callMethod"===e.type});e.currentActionQueue=e.actionQueue,e.actionQueue=[];var n={id:e.id,data:e.data,checksum:e.checksum,actionQueue:e.currentActionQueue,epoch:Date.now(),hash:e.hash},r={Accept:"application/json","X-Requested-With":"XMLHttpRequest"};return r[e.csrfTokenHeaderName]=function(e){var t=e.csrfTokenCookieName+"=",i=e.document.cookie.split(";").filter(function(e){return e.trim().startsWith(t)});if(i.length>0)return i[0].replace(t,"");var n=e.document.getElementsByName("csrfmiddlewaretoken");if(n&&n.length>0)return n[0].getAttribute("value");throw Error("CSRF token is missing. Do you need to add {% csrf_token %}?")}(e),fetch(e.syncUrl,{method:"POST",headers:r,body:JSON.stringify(n)}).then(function(t){if(t.ok)return t.json();if(e.loadingEls.forEach(function(e){e.loading.hide?e.show():e.loading.show&&e.hide(),e.handleLoading(!0),e.handleDirty(!0)}),e.actionCleanups.forEach(function(e){return e()}),e.actionCleanups=[],304===t.status)return null;throw Error("Error when getting response: ".concat(t.statusText," (").concat(t.status,")"))}).then(function(n){if(e.actionCleanups.forEach(function(e){return e()}),e.actionCleanups=[],n&&(!n.queued||!0!==n.queued)){if(n.error)throw"Checksum does not match"===n.error&&u(t)&&t([],!0,null),Error(n.error);if(n.redirect)if(n.redirect.url){if(!n.redirect.refresh)return void(e.window.location.href=n.redirect.url);n.redirect.title&&(e.window.document.title=n.redirect.title),e.window.history.pushState({},"",n.redirect.url)}else n.redirect.hash&&(e.window.location.hash=n.redirect.hash);e.modelEls.forEach(function(e){e.init(),e.removeErrors(),e.handleDirty(!0)}),Object.keys(n.data||{}).forEach(function(t){e.data[t]=n.data[t]}),e.errors=n.errors||{},e.return=n.return||{},e.hash=n.hash;var r=n.parent||{},o=n.dom||"",a=n.partials||[],s=n.checksum,c=n.poll||{};for(l(c)&&(e.poll.timer&&clearInterval(e.poll.timer),c.timing&&(e.poll.timing=c.timing),c.method&&(e.poll.method=c.method),e.poll.disable=c.disable||!1,e.startPolling());l(r)&&l(r.id);){var h=e.getParentComponent(r.id);h&&h.id===r.id&&(l(r.data)&&(h.data=r.data),r.dom&&(h.morphRoot(r.dom),h.loadingEls.forEach(function(e){e.loading.hide?e.show():e.loading.show&&e.hide(),e.handleLoading(!0),e.handleDirty(!0)})),r.checksum&&(h.root.setAttribute("unicorn:checksum",r.checksum),h.refreshChecksum()),h.hash=r.hash,h.refreshEventListeners()),r=r.parent||{}}if(a.length>0){for(var f=0;f<a.length;f++){var m=a[f],p=null;m.key?p=d('[unicorn\\:key="'.concat(m.key,'"]'),e.root):m.id&&(p=d("#".concat(m.id),e.root)),!p&&e.root.parentElement&&(p=d('[unicorn\\:key="'.concat(m.key,'"]'),e.root.parentElement)),p&&e.morph(p,m.dom)}s&&(e.root.setAttribute("unicorn:checksum",s),e.refreshChecksum())}else o&&e.morphRoot(o);e.triggerLifecycleEvent("updated");try{e.init()}catch(e){return}e.refreshEventListeners();var v=!0;e.visibilityEls.forEach(function(t){t.visibility.method===e.return.method&&!1===e.return.value&&(v=!1)}),v&&e.initVisibility(),e.modelEls.forEach(function(t){Object.keys(e.errors).forEach(function(i){if(t.model.name===i){var n=e.errors[i][0];t.addError(n)}})}),e.callCalls(n.calls);var g=e.lastTriggeringElements;e.lastTriggeringElements=[],e.currentActionQueue=null,u(t)&&t(g,i,null)}}).catch(function(i){e.actionQueue=[],e.currentActionQueue=null,e.lastTriggeringElements=[],e.actionCleanups.forEach(function(e){return e()}),e.actionCleanups=[],u(t)&&t(null,null,i)})}}var w=function(){return n(function e(t){i(this,e),this.id=t.id,this.name=t.name,this.key=t.key,this.messageUrl=t.messageUrl,this.csrfTokenHeaderName=t.csrfTokenHeaderName,this.csrfTokenCookieName=t.csrfTokenCookieName,this.hash=t.hash,this.data=t.data||{},this.syncUrl="".concat(this.messageUrl,"/").concat(this.name),this.document=t.document||document,this.walker=t.walker||m,this.window=t.window||window,this.morpher=t.morpher,this.root=void 0,this.modelEls=[],this.loadingEls=[],this.keyEls=[],this.visibilityEls=[],this.errors={},this.return={},this.poll={},this.actionQueue=[],this.actionCleanups=[],this.currentActionQueue=null,this.lastTriggeringElements=[],this.actionEvents={},this.attachedEventTypes=[],this.attachedModelEvents=[],this.init(),this.refreshEventListeners(),this.initVisibility(),this.initPolling(),this.callCalls(t.calls)},[{key:"init",value:function(){if(this.root=d('[unicorn\\:id="'.concat(this.id,'"]'),this.document),!this.root)throw Error("No id found");this.refreshChecksum()}},{key:"getChildrenComponents",value:function(){var e=this,t=[];return this.walker(this.root,function(i){if(!i.isSameNode(e.root)){var n=i.getAttribute("unicorn:id");if(n){var r=k[n]||null;r&&t.push(r)}}}),t}},{key:"getParentComponent",value:function(e){if(void 0!==e)return k[e]||null;for(var t=this.root,i=null;!i&&null!==t.parentElement;){var n=(t=t.parentElement).getAttribute("unicorn:id");n&&(i=k[n]||null)}return i}},{key:"callCalls",value:function(e){var t=this,i=[];return(e=e||[]).forEach(function(e){var n,o=e.fn,a=t.window;(e.fn.split(".").forEach(function(t,i){i<e.fn.split(".").length-1&&(a=a[t],o=o.slice(t.length+1))}),e.args)?i.push((n=a)[o].apply(n,r(e.args))):i.push(a[o]())}),i}},{key:"refreshEventListeners",value:function(){var e=this;this.actionEvents={},this.modelEls=[],this.loadingEls=[],this.visibilityEls=[];try{this.walker(this.root,function(t){if(!t.isSameNode(e.root)){var i=new v(t);i.isUnicorn&&(l(i.model)?(e.attachedModelEvents.some(function(e){return e.isSame(i)})||(e.attachedModelEvents.push(i),E(e,i),i.model.isLazy&&E(e,i,"input")),e.modelEls.some(function(e){return e.isSame(i)})||e.modelEls.push(i)):l(i.loading)&&(e.loadingEls.push(i),i.loading.show&&i.hide()),l(i.key)&&e.keyEls.push(i),l(i.visibility)&&e.visibilityEls.push(i),i.actions.forEach(function(t){e.actionEvents[t.eventType]?e.actionEvents[t.eventType].push({action:t,element:i}):(e.actionEvents[t.eventType]=[{action:t,element:i}],e.attachedEventTypes.some(function(e){return e===t.eventType})||(e.attachedEventTypes.push(t.eventType),b(e,t.eventType),i.events.push(t.eventType)))}))}},f)}catch(e){}}},{key:"callMethod",value:function(e,t,i,n){var r=this,o={type:"callMethod",payload:{name:e},partials:i};this.actionQueue.push(o),this.queueMessage(t,function(e,t,i){i&&u(n)?n(i):i?console.error(i):r.setModelValues(e,!0,!0)})}},{key:"initVisibility",value:function(){var e=this;"undefined"!=typeof window&&"IntersectionObserver"in window&&"IntersectionObserverEntry"in window&&"intersectionRatio"in window.IntersectionObserverEntry.prototype&&this.visibilityEls.forEach(function(t){new IntersectionObserver(function(i){i[0].isIntersecting&&e.callMethod(t.visibility.method,t.visibility.debounceTime,t.partials,function(e){e&&console.error(e)})},{threshold:[t.visibility.threshold]}).observe(t.el)})}},{key:"handlePollError",value:function(e){e?console.error(e):this.poll.timer&&clearInterval(this.poll.timer)}},{key:"isPollEnabled",value:function(){if(!this.poll.disable){if(!l(this.poll.disableData))return!0;if(this.poll.disableData.startsWith("!")){if(this.poll.disableData=this.poll.disableData.slice(1),this.data[this.poll.disableData])return this.poll.disableData="!".concat(this.poll.disableData),!0;this.poll.disableData="!".concat(this.poll.disableData)}else if(!this.data[this.poll.disableData])return!0}return!1}},{key:"initPolling",value:function(){var e=this,t=new v(this.root);t.isUnicorn&&l(t.poll)&&(this.poll=t.poll,this.poll.timer=null,this.document.addEventListener("visibilitychange",function(){e.document.hidden?e.poll.timer&&clearInterval(e.poll.timer):e.startPolling(!0)},!1),this.poll.partials=t.partials,this.startPolling(!0))}},{key:"startPolling",value:function(e){var t=this;e&&this.isPollEnabled()&&this.callMethod(this.poll.method,0,this.poll.partials,this.handlePollError),this.poll.timer=setInterval(function(){t.isPollEnabled()&&t.callMethod(t.poll.method,0,t.poll.partials,t.handlePollError)},this.poll.timing)}},{key:"refreshChecksum",value:function(){this.checksum=this.root.getAttribute("unicorn:checksum")}},{key:"setValue",value:function(e){s(e.model)||this.setNestedValue(e,e.model.name,this.data)}},{key:"setNestedValue",value:function(e,t,i){for(var n=t.split("."),r=i,o=0;o<n.length;o++){var a=n[o];if(null==r)return;Object.prototype.hasOwnProperty.call(r,a)&&(o===n.length-1?e.setValue(r[a]):r=r[a])}}},{key:"setModelValues",value:function(e,t,i){var n=this;t=t||!1,i=i||!1;var r=null;if((e=e||[]).length>0){var o=!1;l(r=e.slice(-1)[0])&&l(r.model)&&!r.model.isLazy&&["id","key"].forEach(function(e){n.modelEls.forEach(function(t){o||r[e]&&r[e]===t[e]&&(t.focus(),o=!0)})})}if(this.modelEls.forEach(function(e){!t&&r&&r.isSame(e)||n.setValue(e)}),this.getChildrenComponents().forEach(function(i){i.setModelValues(e,t,!1)}),i){var a=this.getParentComponent();a&&a.setModelValues(e,t,i)}}},{key:"queueMessage",value:function(e,t){-1===e?a(T,250)(this,t):a(T,e)(this,t)}},{key:"triggerLifecycleEvent",value:function(e){var t=this;e in A&&A[e].forEach(function(e){return e(t)})}},{key:"trigger",value:function(e){this.modelEls.forEach(function(t){if(t.key===e){var i=t.model.isLazy?"blur":"input";t.el.dispatchEvent(new Event(i))}})}},{key:"morph",value:function(e,t){if(t){var i=function(){return r(e.querySelectorAll("[unicorn\\:id]"))},n=new Set(i().map(function(e){return e.getAttribute("unicorn:id")}));this.morpher.morph(e,t);var o=new Set(i().map(function(e){return e.getAttribute("unicorn:id")}));r(n).filter(function(e){return!o.has(e)}).forEach(function(e){Unicorn.deleteComponent(e)}),i().forEach(function(e){Unicorn.insertComponentFromDom(e)})}}},{key:"morphRoot",value:function(e){this.morph(this.root,e)}}])}(),S=function(){const e=()=>{},t={morphStyle:"outerHTML",callbacks:{beforeNodeAdded:e,afterNodeAdded:e,beforeNodeMorphed:e,afterNodeMorphed:e,beforeNodeRemoved:e,afterNodeRemoved:e,beforeAttributeUpdated:e},head:{style:"merge",shouldPreserve:e=>"true"===e.getAttribute("im-preserve"),shouldReAppend:e=>"true"===e.getAttribute("im-re-append"),shouldRemove:e,afterHeadMorphed:e},restoreFocus:!0};const i=function(){function e(e,t,i,r){if(!1===r.callbacks.beforeNodeAdded(t))return null;if(r.idMap.has(t)){const o=document.createElement(t.tagName);return e.insertBefore(o,i),n(o,t,r),r.callbacks.afterNodeAdded(o),o}{const n=document.importNode(t,!0);return e.insertBefore(n,i),r.callbacks.afterNodeAdded(n),n}}const t=function(){function e(e,t,i){let n=e.idMap.get(t),r=e.idMap.get(i);if(!r||!n)return!1;for(const e of n)if(r.has(e))return!0;return!1}function t(e,t){const i=e,n=t;return i.nodeType===n.nodeType&&i.tagName===n.tagName&&(!i.getAttribute?.("id")||i.getAttribute?.("id")===n.getAttribute?.("id"))}return function(i,n,r,o){let a=null,s=n.nextSibling,l=0,u=r;for(;u&&u!=o;){if(t(u,n)){if(e(i,u,n))return u;null===a&&(i.idMap.has(u)||(a=u))}if(null===a&&s&&t(u,s)&&(l++,s=s.nextSibling,l>=2&&(a=void 0)),i.activeElementAndParents.includes(u))break;u=u.nextSibling}return a||null}}();function i(e,t){if(e.idMap.has(t))a(e.pantry,t,null);else{if(!1===e.callbacks.beforeNodeRemoved(t))return;t.parentNode?.removeChild(t),e.callbacks.afterNodeRemoved(t)}}function r(e,t,n){let r=t;for(;r&&r!==n;){let t=r;r=r.nextSibling,i(e,t)}return r}function o(e,t,i,n){const r=n.target.getAttribute?.("id")===t&&n.target||n.target.querySelector(`[id="${t}"]`)||n.pantry.querySelector(`[id="${t}"]`);return function(e,t){const i=e.getAttribute("id");for(;e=e.parentNode;){let n=t.idMap.get(e);n&&(n.delete(i),n.size||t.idMap.delete(e))}}(r,n),a(e,r,i),r}function a(e,t,i){if(e.moveBefore)try{e.moveBefore(t,i)}catch(n){e.insertBefore(t,i)}else e.insertBefore(t,i)}return function(a,s,l,u=null,c=null){s instanceof HTMLTemplateElement&&l instanceof HTMLTemplateElement&&(s=s.content,l=l.content),u||=s.firstChild;for(const i of l.childNodes){if(u&&u!=c){const e=t(a,i,u,c);if(e){e!==u&&r(a,u,e),n(e,i,a),u=e.nextSibling;continue}}if(i instanceof Element){const e=i.getAttribute("id");if(a.persistentIds.has(e)){const t=o(s,e,u,a);n(t,i,a),u=t.nextSibling;continue}}const l=e(s,i,u,a);l&&(u=l.nextSibling)}for(;u&&u!=c;){const e=u;u=u.nextSibling,i(a,e)}}}(),n=function(){function e(e,i,n,r){const o=i[n];if(o!==e[n]){const a=t(n,e,"update",r);a||(e[n]=i[n]),o?a||e.setAttribute(n,""):t(n,e,"remove",r)||e.removeAttribute(n)}}function t(e,t,i,n){return!("value"!==e||!n.ignoreActiveValue||t!==document.activeElement)||!1===n.callbacks.beforeAttributeUpdated(e,t,i)}function n(e,t){return!!t.ignoreActiveValue&&e===document.activeElement&&e!==document.body}return function(o,a,s){return s.ignoreActive&&o===document.activeElement?null:(!1===s.callbacks.beforeNodeMorphed(o,a)||(o instanceof HTMLHeadElement&&s.head.ignore||(o instanceof HTMLHeadElement&&"morph"!==s.head.style?r(o,a,s):(!function(i,r,o){let a=r.nodeType;if(1===a){const a=i,s=r,l=a.attributes,u=s.attributes;for(const e of u)t(e.name,a,"update",o)||a.getAttribute(e.name)!==e.value&&a.setAttribute(e.name,e.value);for(let e=l.length-1;0<=e;e--){const i=l[e];if(i&&!s.hasAttribute(i.name)){if(t(i.name,a,"remove",o))continue;a.removeAttribute(i.name)}}n(a,o)||function(i,n,r){if(i instanceof HTMLInputElement&&n instanceof HTMLInputElement&&"file"!==n.type){let o=n.value,a=i.value;e(i,n,"checked",r),e(i,n,"disabled",r),n.hasAttribute("value")?a!==o&&(t("value",i,"update",r)||(i.setAttribute("value",o),i.value=o)):t("value",i,"remove",r)||(i.value="",i.removeAttribute("value"))}else if(i instanceof HTMLOptionElement&&n instanceof HTMLOptionElement)e(i,n,"selected",r);else if(i instanceof HTMLTextAreaElement&&n instanceof HTMLTextAreaElement){let e=n.value,o=i.value;if(t("value",i,"update",r))return;e!==o&&(i.value=e),i.firstChild&&i.firstChild.nodeValue!==e&&(i.firstChild.nodeValue=e)}}(a,s,o)}8!==a&&3!==a||i.nodeValue!==r.nodeValue&&(i.nodeValue=r.nodeValue)}(o,a,s),n(o,s)||i(s,o,a))),s.callbacks.afterNodeMorphed(o,a)),o)}}();function r(e,t,i){let n=[],r=[],o=[],a=[],s=new Map;for(const e of t.children)s.set(e.outerHTML,e);for(const t of e.children){let e=s.has(t.outerHTML),n=i.head.shouldReAppend(t),l=i.head.shouldPreserve(t);e||l?n?r.push(t):(s.delete(t.outerHTML),o.push(t)):"append"===i.head.style?n&&(r.push(t),a.push(t)):!1!==i.head.shouldRemove(t)&&r.push(t)}a.push(...s.values());let l=[];for(const t of a){let r=document.createRange().createContextualFragment(t.outerHTML).firstChild;if(!1!==i.callbacks.beforeNodeAdded(r)){if("href"in r&&r.href||"src"in r&&r.src){let e,t=new Promise(function(t){e=t});r.addEventListener("load",function(){e()}),l.push(t)}e.appendChild(r),i.callbacks.afterNodeAdded(r),n.push(r)}}for(const t of r)!1!==i.callbacks.beforeNodeRemoved(t)&&(e.removeChild(t),i.callbacks.afterNodeRemoved(t));return i.head.afterHeadMorphed(e,{added:n,kept:o,removed:r}),l}const o=function(){function e(){const e=document.createElement("div");return e.hidden=!0,document.body.insertAdjacentElement("afterend",e),e}function i(e){let t=[],i=document.activeElement;if("BODY"!==i?.tagName&&e.contains(i))for(;i&&(t.push(i),i!==e);)i=i.parentElement;return t}function n(e){let t=Array.from(e.querySelectorAll("[id]"));return e.getAttribute?.("id")&&t.push(e),t}function r(e,t,i,n){for(const r of n){const n=r.getAttribute("id");if(t.has(n)){let t=r;for(;t;){let r=e.get(t);if(null==r&&(r=new Set,e.set(t,r)),r.add(n),t===i)break;t=t.parentElement}}}}return function(o,a,s){const{persistentIds:l,idMap:u}=function(e,t){const i=n(e),o=n(t),a=function(e,t){let i=new Set,n=new Map;for(const{id:t,tagName:r}of e)n.has(t)?i.add(t):n.set(t,r);let r=new Set;for(const{id:e,tagName:o}of t)r.has(e)?i.add(e):n.get(e)===o&&r.add(e);for(const e of i)r.delete(e);return r}(i,o);let s=new Map;r(s,a,e,i);const l=t.__idiomorphRoot||t;return r(s,a,l,o),{persistentIds:a,idMap:s}}(o,a),c=function(e){let i=Object.assign({},t);return Object.assign(i,e),i.callbacks=Object.assign({},t.callbacks,e.callbacks),i.head=Object.assign({},t.head,e.head),i}(s),d=c.morphStyle||"outerHTML";if(!["innerHTML","outerHTML"].includes(d))throw`Do not understand how to morph style ${d}`;return{target:o,newContent:a,config:c,morphStyle:d,ignoreActive:c.ignoreActive,ignoreActiveValue:c.ignoreActiveValue,restoreFocus:c.restoreFocus,idMap:u,persistentIds:l,pantry:e(),activeElementAndParents:i(o),callbacks:c.callbacks,head:c.head}}}(),{normalizeElement:a,normalizeParent:s}=function(){const e=new WeakSet;class t{constructor(e){this.originalNode=e,this.realParentNode=e.parentNode,this.previousSibling=e.previousSibling,this.nextSibling=e.nextSibling}get childNodes(){const e=[];let t=this.previousSibling?this.previousSibling.nextSibling:this.realParentNode.firstChild;for(;t&&t!=this.nextSibling;)e.push(t),t=t.nextSibling;return e}querySelectorAll(e){return this.childNodes.reduce((t,i)=>{if(i instanceof Element){i.matches(e)&&t.push(i);const n=i.querySelectorAll(e);for(let e=0;e<n.length;e++)t.push(n[e])}return t},[])}insertBefore(e,t){return this.realParentNode.insertBefore(e,t)}moveBefore(e,t){return this.realParentNode.moveBefore(e,t)}get __idiomorphRoot(){return this.originalNode}}return{normalizeElement:function(e){return e instanceof Document?e.documentElement:e},normalizeParent:function i(n){if(null==n)return document.createElement("div");if("string"==typeof n)return i(function(t){let i=new DOMParser,n=t.replace(/<svg(\s[^>]*>|>)([\s\S]*?)<\/svg>/gim,"");if(n.match(/<\/html>/)||n.match(/<\/head>/)||n.match(/<\/body>/)){let r=i.parseFromString(t,"text/html");if(n.match(/<\/html>/))return e.add(r),r;{let t=r.firstChild;return t&&e.add(t),t}}{let n=i.parseFromString("<body><template>"+t+"</template></body>","text/html").body.querySelector("template").content;return e.add(n),n}}(n));if(e.has(n))return n;if(n instanceof Node){if(n.parentNode)return new t(n);{const e=document.createElement("div");return e.append(n),e}}{const e=document.createElement("div");for(const t of[...n])e.append(t);return e}}}}();return{morph:function(e,t,n={}){e=a(e);const l=s(t),u=o(e,l,n),c=function(e,t){if(!e.config.restoreFocus)return t();let i=document.activeElement;if(!(i instanceof HTMLInputElement||i instanceof HTMLTextAreaElement))return t();const{id:n,selectionStart:r,selectionEnd:o}=i,a=t();n&&n!==document.activeElement?.getAttribute("id")&&(i=e.target.querySelector(`[id="${n}"]`),i?.focus());i&&!i.selectionEnd&&o&&i.setSelectionRange(r,o);return a}(u,()=>function(e,t,i,n){if(e.head.block){const o=t.querySelector("head"),a=i.querySelector("head");if(o&&a){const t=r(o,a,e);return Promise.all(t).then(()=>{const t=Object.assign(e,{head:{block:!1,ignore:!0}});return n(t)})}}return n(e)}(u,e,l,t=>"innerHTML"===t.morphStyle?(i(t,e,l),Array.from(e.childNodes)):function(e,t,n){const r=s(t);return i(e,r,n,t,t.nextSibling),Array.from(r.childNodes)}(t,e,l)));return u.pantry.remove(),c},defaults:t}}(),N=function(){return n(function e(t){i(this,e),this.options=t},[{key:"morph",value:function(e,t){return S.morph(e,t,{morphStyle:"innerHTML"})}}])}();var L,M="",C="X-CSRFToken",P="csrftoken";function D(e){e.messageUrl=M,e.csrfTokenHeaderName=C,e.csrfTokenCookieName=P,e.morpher=L;var t=new w(e);k[t.id]=t,t.setModelValues()}function V(e){var t;if(Object.keys(k).forEach(function(i){if(s(t)){var n=k[i];String(n.key)===String(e)&&(t=n)}}),s(t)&&Object.keys(k).forEach(function(i){if(s(t)){var n=k[i];n.name===e&&(t=n)}}),!t)throw Error("No component found for: ".concat(e));return t}return e.addEventListener=function(e,t){e in A||(A[e]=[]),A[e].push(t)},e.call=function(e,t){for(var i=V(e),n="",r=arguments.length,o=new Array(r>2?r-2:0),a=2;a<r;a++)o[a-2]=arguments[a];o.forEach(function(e){void 0!==e&&(n="string"==typeof e?"".concat(n,"'").concat(e,"', "):"".concat(n).concat(e,", "))}),n&&(n=n.slice(0,-2),t="".concat(t,"(").concat(n,")")),i.callMethod(t,0,null,function(e){console.error(e)})},e.componentInit=D,e.deleteComponent=function(e){delete k[e]},e.getComponent=V,e.getReturnValue=function(e){return V(e).return.value},e.init=function(e,t,i,n){return M=e,L=new N(n),l(t)&&(C=t),l(i)&&(P=i),{messageUrl:M,csrfTokenHeaderName:C,csrfTokenCookieName:P,morpher:L}},e.insertComponentFromDom=function(e){var t=e.getAttribute("unicorn:id");k[t]||D({id:t,name:e.getAttribute("unicorn:name"),key:e.getAttribute("unicorn:key"),checksum:e.getAttribute("unicorn:checksum"),data:JSON.parse(e.getAttribute("unicorn:data")),calls:JSON.parse(e.getAttribute("unicorn:calls"))})},e.trigger=function(e,t){V(e).trigger(t)},e}({});
